<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja</title>
    <link rel="stylesheet" href="CSS/storestyle.css">
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400..700;1,400..700&family=Julius+Sans+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>
<body>
    <h1 class="winphrase">Monte da<br>Concen-<br>tração</h1>
    
    <!--PRODUTOS-->
    <div class="teste">
        <h1 class="instsans" id="pcatual"></h1>
        <div class="produto">
            <img onclick="buy1()" id="img1" class="produtoIMG" src="" alt="">
            <p id="preco1" class="produtoPRECO instsans">ERROR </p>
            <p id="rank1" class="produtoRANK instsans">ERROR <i class="fa-solid fa-star" style="color: #FFD43B;"></i></p>
        </div>
        <div class="produto">
            <img onclick="buy2()" id="img2" class="produtoIMG" src="" alt="">
            <p id="preco2" class="produtoPRECO instsans">ERROR </p>
            <p id="rank2" class="produtoRANK instsans">ERROR <i class="fa-solid fa-star" style="color: #FFD43B;"></i></p>
        </div>
        <div class="produto">
            <img onclick="buy3()" id="img3" class="produtoIMG" src="" alt="">
            <p id="preco3" class="produtoPRECO instsans">ERROR </p>
            <p id="rank3" class="produtoRANK instsans">ERROR <i class="fa-solid fa-star" style="color: #FFD43B;"></i></p>
        </div>
       
        
        
    </div>

    <!--COMENTARIOS-->
    <div class="comentario instsans"><i class="fa-solid fa-angles-left"></i><i><b>
        Este é o lugar onde você vai usar os seus PC para usufruir de merecidas recompensas.
    </b></i><i class="fa-solid fa-angles-right"></i>
    </div>
    <div class="comentario instsans"><i class="fa-solid fa-angles-left"></i><i><b>Você pode usar o seus Pontos de Concentração<br>
        para várias coisas, de início, use-os para comprar <br>
        cosméticos e aumentar sua pontuação geral!</b></i><i class="fa-solid fa-angles-right"></i>
    </div>
    <div class="comentario instsans"><i class="fa-solid fa-angles-left"></i><i><b> Davy jones já zerou todos esses  upgrades, TODOS. </b></i><i class="fa-solid fa-angles-right"></i>
    </div>
    <div class="comentario instsans"><i class="fa-solid fa-angles-left"></i><i><b>Infelizmente desenvolvedores não são imunes à dor de cabeça.</b></i><i class="fa-solid fa-angles-right"></i>
    </div>
<script>
    //FETCH PATCH: Lançar PC pós compra
    async function Patch1(item) {
        try{
            const res= await fetch(`http://localhost:3000/recursos/${sessionStorage.getItem('userId')}`,{
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    pc: item
                })
            })
            comsole.log("pc atualizado com êxito")
        }
        catch{}
    }
    //FETCH PATCH: Lançar produto 1 no inventário o usuário
    async function PatchItem1() {
        try{
            const res= await fetch(`http://localhost:3000/usuarios/${sessionStorage.getItem('userId')}`,{
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    item1: true
                })
            })
            comsole.log("pc atualizado com êxito")
        }
        catch{}
    }

    //FETCH PATCH: Lançar produto 2 no inventário o usuário
    async function PatchItem2() {
    try{
        const res= await fetch(`http://localhost:3000/usuarios/${sessionStorage.getItem('userId')}`,{
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                item2: true
            })
        })
        comsole.log("pc atualizado com êxito")
    }
    catch{}
    }

    //FETCH PATCH: Lançar produto 3 no inventário o usuário

    async function PatchItem3() {
    try{
    const res= await fetch(`http://localhost:3000/usuarios/${sessionStorage.getItem('userId')}`,{
        method: 'PATCH',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            item3: true
        })
    })
     comsole.log("pc atualizado com êxito")
        }
        catch{}
    }



    //PCS ATUAIS
    async function rogerio() {
        try{
            const res= await fetch(`http://localhost:3000/recursos/${sessionStorage.getItem('userId')}`)
            const data= await res.json()

            document.getElementById('pcatual').textContent='PC: '+ data.pc
        }
        catch{}
   }
    rogerio()


    //MOSTRAR ITENS
    async function showItems(){
        try{
            //ITEM 1
            const res= await fetch('http://localhost:3000/itens/1')
            const data= await res.json()
            

            document.getElementById('preco1').textContent='PC '+ data.valor
            document.getElementById('img1').src= data.img
            document.getElementById('rank1').innerHTML= data.rank+'<i class="fa-solid fa-star" style="color: #FFD43B;"></i>'
            
            //ITEM 2
            const res2= await fetch('http://localhost:3000/itens/2')
            const data2= await res2.json()
            

            document.getElementById('preco2').textContent='PC '+ data2.valor
            document.getElementById('img2').src= data2.img
            document.getElementById('rank2').innerHTML= data2.rank+'<i class="fa-solid fa-star" style="color: #FFD43B;"></i>'

            //ITEM 3
            const res3= await fetch('http://localhost:3000/itens/3')
            const data3= await res3.json()
            

            document.getElementById('preco3').textContent='PC '+ data3.valor
            document.getElementById('img3').src= data3.img
            document.getElementById('rank3').innerHTML= data3.rank+'<i class="fa-solid fa-star" style="color: #FFD43B;"></i>'
        }
        catch{}



        
    }

    //COMPRAR ITEM
    async function buy1(){
    try{
        //RECEBE OS PC ATUAIS DO SERVIDOR
        const res = await fetch(`http://localhost:3000/recursos/${sessionStorage.getItem('userId')}`)
        const data= await res.json()
        const PC= await data.pc
        let intPC= parseInt(PC)
        
        //RECEBE O PREÇO DA COMPRA
        const preco=document.getElementById('preco1').textContent
        const price= preco.slice(3,999)
        const intPrice= parseInt(price)

        //RECEBE SE O ITEM JÁ FOI COMPRADO
        const res2= await fetch(`http://localhost:3000/usuarios/${sessionStorage.getItem('userId')}`)
        const data2= await res2.json()

        //CONDICIONAL DE COMPRA
        if(intPC> intPrice && !data2.item1){

            intPC= intPC - intPrice
            Patch1(intPC)

            const Item1= true;
            PatchItem1()
            window.location.href='loja.html'
        }
        else if(data2.item1){
            alert('Voce já tem esse item!')
        }
        else if(intPC< intPrice){
            alert('PC insuficiente para a compra :(')
        }
    }
    catch{}
    }

    //COMPRAR ITEM 2
    async function buy2(){
    try{
        //RECEBE OS PC ATUAIS DO SERVIDOR
        const res = await fetch(`http://localhost:3000/recursos/${sessionStorage.getItem('userId')}`)
        const data= await res.json()
        const PC= await data.pc
        let intPC= parseInt(PC)
        
        //RECEBE O PREÇO DA COMPRA
        const preco=document.getElementById('preco2').textContent
        const price= preco.slice(3,999)
        const intPrice= parseInt(price)

        //RECEBE SE O ITEM JÁ FOI COMPRADO
        const res2= await fetch(`http://localhost:3000/usuarios/${sessionStorage.getItem('userId')}`)
        const data2= await res2.json()

        //CONDICIONAL DE COMPRA
        if(intPC> intPrice && !data2.item2){

            intPC= intPC - intPrice
            Patch1(intPC)

            PatchItem2()
            console.log('hi')
            window.location.href='loja.html'
        }
        else if(data2.item2){
            alert('Voce já tem esse item!')
        }
        else if(intPC< intPrice){
            alert('PC insuficiente para a compra :(')
        }
    }
    catch{}
    }


    //COMPRAR ITEM 3
    async function buy3(){
    try{
        //RECEBE OS PC ATUAIS DO SERVIDOR
        const res = await fetch(`http://localhost:3000/recursos/${sessionStorage.getItem('userId')}`)
        const data= await res.json()
        const PC= await data.pc
        let intPC= parseInt(PC)
        
        //RECEBE O PREÇO DA COMPRA
        const preco=document.getElementById('preco3').textContent
        const price= preco.slice(3,999)
        const intPrice= parseInt(price)

        //RECEBE SE O ITEM JÁ FOI COMPRADO
        const res2= await fetch(`http://localhost:3000/usuarios/${sessionStorage.getItem('userId')}`)
        const data2= await res2.json()

        //CONDICIONAL DE COMPRA
        if(intPC> intPrice && !data2.item3){

            intPC= intPC - intPrice
            console.log('hi')
            Patch1(intPC)

            PatchItem3()
            console.log('hi')
            window.location.href='loja.html'
        }
        else if(data2.item3){
            alert('Voce já tem esse item!')
        }
        else if(intPC< intPrice){
            alert('PC insuficiente para a compra :(')
        }
    }
    catch{}
    }
    


    showItems()
</script>
</body>
</html>